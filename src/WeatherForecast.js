import React, { Component } from 'react';
import './WeatherForecast.css';

import DayDetails from './components/day_details/day_details';
import Api from './services/api';

// preoloader, test jakis, opublikowac
// var fakeResponse = {"city":{"id":2643743,"name":"London","coord":{"lon":-0.12574,"lat":51.50853},"country":"GB","population":0,"sys":{"population":0}},"cod":"200","message":0.1668,"cnt":30,"list":[{"dt":1480917600,"main":{"temp":-2.48,"temp_min":-2.48,"temp_max":-1.96,"pressure":1029.95,"sea_level":1037.99,"grnd_level":1029.95,"humidity":100,"temp_kf":-0.52},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":36},"wind":{"speed":1.57,"deg":93.0002},"sys":{"pod":"n"},"dt_txt":"2016-12-05 06:00:00"},{"dt":1480928400,"main":{"temp":-1.28,"temp_min":-1.28,"temp_max":-0.94,"pressure":1030.52,"sea_level":1038.51,"grnd_level":1030.52,"humidity":98,"temp_kf":-0.35},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"02d"}],"clouds":{"all":8},"wind":{"speed":2.34,"deg":99.5049},"sys":{"pod":"d"},"dt_txt":"2016-12-05 09:00:00"},{"dt":1480939200,"main":{"temp":5.39,"temp_min":5.39,"temp_max":5.56,"pressure":1030.21,"sea_level":1038.03,"grnd_level":1030.21,"humidity":91,"temp_kf":-0.17},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"02d"}],"clouds":{"all":8},"wind":{"speed":2.23,"deg":127.502},"sys":{"pod":"d"},"dt_txt":"2016-12-05 12:00:00"},{"dt":1480950000,"main":{"temp":5.69,"temp_min":5.69,"temp_max":5.69,"pressure":1030.06,"sea_level":1037.79,"grnd_level":1030.06,"humidity":92,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"02d"}],"clouds":{"all":8},"wind":{"speed":1.74,"deg":109},"sys":{"pod":"d"},"dt_txt":"2016-12-05 15:00:00"},{"dt":1480960800,"main":{"temp":0.94,"temp_min":0.94,"temp_max":0.94,"pressure":1030.27,"sea_level":1038.32,"grnd_level":1030.27,"humidity":98,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":24},"wind":{"speed":2.34,"deg":115.5},"sys":{"pod":"n"},"dt_txt":"2016-12-05 18:00:00"},{"dt":1480971600,"main":{"temp":-1.22,"temp_min":-1.22,"temp_max":-1.22,"pressure":1030.38,"sea_level":1038.45,"grnd_level":1030.38,"humidity":94,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":32},"wind":{"speed":1.16,"deg":112},"sys":{"pod":"n"},"dt_txt":"2016-12-05 21:00:00"},{"dt":1480982400,"main":{"temp":-1.73,"temp_min":-1.73,"temp_max":-1.73,"pressure":1030.67,"sea_level":1038.72,"grnd_level":1030.67,"humidity":89,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":32},"wind":{"speed":1.16,"deg":116.001},"sys":{"pod":"n"},"dt_txt":"2016-12-06 00:00:00"},{"dt":1480993200,"main":{"temp":-0.91,"temp_min":-0.91,"temp_max":-0.91,"pressure":1030.16,"sea_level":1038.12,"grnd_level":1030.16,"humidity":84,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":88},"wind":{"speed":1.4,"deg":104},"sys":{"pod":"n"},"dt_txt":"2016-12-06 03:00:00"},{"dt":1481004000,"main":{"temp":1.4,"temp_min":1.4,"temp_max":1.4,"pressure":1029.74,"sea_level":1037.71,"grnd_level":1029.74,"humidity":95,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.76,"deg":131.504},"sys":{"pod":"n"},"dt_txt":"2016-12-06 06:00:00"},{"dt":1481014800,"main":{"temp":0.73,"temp_min":0.73,"temp_max":0.73,"pressure":1030.8,"sea_level":1038.71,"grnd_level":1030.8,"humidity":92,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":56},"wind":{"speed":1.17,"deg":120.001},"sys":{"pod":"d"},"dt_txt":"2016-12-06 09:00:00"},{"dt":1481025600,"main":{"temp":7.64,"temp_min":7.64,"temp_max":7.64,"pressure":1030.65,"sea_level":1038.5,"grnd_level":1030.65,"humidity":94,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":80},"wind":{"speed":2.26,"deg":142.501},"sys":{"pod":"d"},"dt_txt":"2016-12-06 12:00:00"},{"dt":1481036400,"main":{"temp":7.92,"temp_min":7.92,"temp_max":7.92,"pressure":1030.79,"sea_level":1038.44,"grnd_level":1030.79,"humidity":100,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":68},"wind":{"speed":2.1,"deg":140.504},"sys":{"pod":"d"},"dt_txt":"2016-12-06 15:00:00"},{"dt":1481047200,"main":{"temp":5.47,"temp_min":5.47,"temp_max":5.47,"pressure":1031.12,"sea_level":1038.97,"grnd_level":1031.12,"humidity":100,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":64},"wind":{"speed":2.67,"deg":142.002},"sys":{"pod":"n"},"dt_txt":"2016-12-06 18:00:00"},{"dt":1481058000,"main":{"temp":5.24,"temp_min":5.24,"temp_max":5.24,"pressure":1031.25,"sea_level":1039.12,"grnd_level":1031.25,"humidity":100,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":64},"wind":{"speed":2.71,"deg":152.505},"sys":{"pod":"n"},"dt_txt":"2016-12-06 21:00:00"},{"dt":1481068800,"main":{"temp":5.81,"temp_min":5.81,"temp_max":5.81,"pressure":1031.12,"sea_level":1038.84,"grnd_level":1031.12,"humidity":100,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":36},"wind":{"speed":2.71,"deg":159.001},"sys":{"pod":"n"},"dt_txt":"2016-12-07 00:00:00"},{"dt":1481079600,"main":{"temp":6.24,"temp_min":6.24,"temp_max":6.24,"pressure":1030.49,"sea_level":1038.29,"grnd_level":1030.49,"humidity":98,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":76},"wind":{"speed":3.06,"deg":168.005},"sys":{"pod":"n"},"dt_txt":"2016-12-07 03:00:00"},{"dt":1481090400,"main":{"temp":7.54,"temp_min":7.54,"temp_max":7.54,"pressure":1029.93,"sea_level":1037.66,"grnd_level":1029.93,"humidity":100,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":3.36,"deg":175.501},"rain":{"3h":0.0175},"sys":{"pod":"n"},"dt_txt":"2016-12-07 06:00:00"},{"dt":1481101200,"main":{"temp":8.4,"temp_min":8.4,"temp_max":8.4,"pressure":1029.89,"sea_level":1037.69,"grnd_level":1029.89,"humidity":100,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":88},"wind":{"speed":3.75,"deg":181.504},"rain":{},"sys":{"pod":"d"},"dt_txt":"2016-12-07 09:00:00"},{"dt":1481112000,"main":{"temp":10.57,"temp_min":10.57,"temp_max":10.57,"pressure":1029.23,"sea_level":1036.85,"grnd_level":1029.23,"humidity":94,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":88},"wind":{"speed":4.2,"deg":186.5},"rain":{},"sys":{"pod":"d"},"dt_txt":"2016-12-07 12:00:00"},{"dt":1481122800,"main":{"temp":11.01,"temp_min":11.01,"temp_max":11.01,"pressure":1028.09,"sea_level":1035.83,"grnd_level":1028.09,"humidity":90,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":92},"wind":{"speed":4.51,"deg":190.007},"rain":{},"sys":{"pod":"d"},"dt_txt":"2016-12-07 15:00:00"},{"dt":1481133600,"main":{"temp":10.48,"temp_min":10.48,"temp_max":10.48,"pressure":1027.56,"sea_level":1035.25,"grnd_level":1027.56,"humidity":91,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":92},"wind":{"speed":4.76,"deg":190.502},"rain":{},"sys":{"pod":"n"},"dt_txt":"2016-12-07 18:00:00"},{"dt":1481144400,"main":{"temp":10.75,"temp_min":10.75,"temp_max":10.75,"pressure":1027.15,"sea_level":1034.78,"grnd_level":1027.15,"humidity":96,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":5.23,"deg":191.502},"rain":{"3h":0.89},"sys":{"pod":"n"},"dt_txt":"2016-12-07 21:00:00"},{"dt":1481155200,"main":{"temp":11.45,"temp_min":11.45,"temp_max":11.45,"pressure":1026.73,"sea_level":1034.43,"grnd_level":1026.73,"humidity":99,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":5.27,"deg":211},"rain":{"3h":4.24},"sys":{"pod":"n"},"dt_txt":"2016-12-08 00:00:00"},{"dt":1481166000,"main":{"temp":12.19,"temp_min":12.19,"temp_max":12.19,"pressure":1027.5,"sea_level":1035.09,"grnd_level":1027.5,"humidity":99,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":80},"wind":{"speed":3.66,"deg":244.002},"rain":{"3h":0.3},"sys":{"pod":"n"},"dt_txt":"2016-12-08 03:00:00"},{"dt":1481176800,"main":{"temp":12.04,"temp_min":12.04,"temp_max":12.04,"pressure":1029.2,"sea_level":1036.77,"grnd_level":1029.2,"humidity":100,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":3.36,"deg":253.001},"rain":{"3h":0.1},"sys":{"pod":"n"},"dt_txt":"2016-12-08 06:00:00"},{"dt":1481187600,"main":{"temp":10.69,"temp_min":10.69,"temp_max":10.69,"pressure":1030.73,"sea_level":1038.44,"grnd_level":1030.73,"humidity":100,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":80},"wind":{"speed":3.01,"deg":255.506},"rain":{"3h":0.08},"sys":{"pod":"d"},"dt_txt":"2016-12-08 09:00:00"},{"dt":1481198400,"main":{"temp":12.21,"temp_min":12.21,"temp_max":12.21,"pressure":1031.58,"sea_level":1039.19,"grnd_level":1031.58,"humidity":100,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":76},"wind":{"speed":2.93,"deg":247.503},"rain":{"3h":0.14},"sys":{"pod":"d"},"dt_txt":"2016-12-08 12:00:00"},{"dt":1481209200,"main":{"temp":12.75,"temp_min":12.75,"temp_max":12.75,"pressure":1030.85,"sea_level":1038.45,"grnd_level":1030.85,"humidity":99,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":3.66,"deg":225.502},"rain":{"3h":0.07},"sys":{"pod":"d"},"dt_txt":"2016-12-08 15:00:00"},{"dt":1481220000,"main":{"temp":12.68,"temp_min":12.68,"temp_max":12.68,"pressure":1030.95,"sea_level":1038.53,"grnd_level":1030.95,"humidity":98,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":80},"wind":{"speed":3.88,"deg":228.004},"rain":{"3h":0.13},"sys":{"pod":"n"},"dt_txt":"2016-12-08 18:00:00"},{"dt":1481230800,"main":{"temp":12.79,"temp_min":12.79,"temp_max":12.79,"pressure":1031.02,"sea_level":1038.72,"grnd_level":1031.02,"humidity":97,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":5.03,"deg":227.504},"rain":{"3h":0.1},"sys":{"pod":"n"},"dt_txt":"2016-12-08 21:00:00"}]}

class WeatherForecast extends Component {
  constructor(props){
    super(props);

    this.state = {
        weatherData: {
          list: []
        }
    };
  }

  componentDidMount(){
    Api.get5daysForecast(this.props.city, this.props.country, this.props.apiKey)
      .then((response) => {
        this.updateWeatherData(response)
      });
  }

  updateWeatherData(data) {
    this.setState({
      weatherData: data
    })
  }

  render() {
    return (
      <section className="weather-component">
        <strong className="city-name">{this.props.city} - 5 day weather forecast.</strong>
        <ul className="forecast-list">
        {
          this.state.weatherData.list.map((dayData) => {
            return <DayDetails data={dayData} key={dayData.dt} />
          })
        }
        </ul>
      </section>
    );
  }
}

WeatherForecast.propTypes = {
    apiKey: React.PropTypes.string.isRequired,
    city: React.PropTypes.string.isRequired,
    country: React.PropTypes.string.isRequired
}

export default WeatherForecast;
